"use strict";const a=require("electron"),p=async(t=10)=>{try{const e=new URL("http://127.0.0.1:8001/modrinth/projects_random/");e.searchParams.set("count",t.toString());const r=await fetch(e.toString(),{method:"GET",cache:"no-store"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(e){throw console.error("Error fetching random projects:",e),e}},f=async(t=10,e,r,n)=>{try{const o=new URL("http://127.0.0.1:8001/modrinth/search/");o.searchParams.set("limit",t.toString()),r&&o.searchParams.set("query",r),n!=null&&o.searchParams.set("offset",n.toString()),e&&o.searchParams.set("facets",JSON.stringify([[`project_type:${e}`]]));const s=await fetch(o.toString(),{method:"GET",cache:"no-store"});if(!s.ok)throw new Error(`HTTP ${s.status}`);return await s.json()}catch(o){throw console.error("Error fetching search projects:",o),o}},g=async t=>{try{const e=await fetch(`http://127.0.0.1:8001/mrpack/metadata/?file_path=${encodeURIComponent(t)}`,{method:"GET",cache:"no-store"});if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()}catch(e){throw console.error("Error fetching Mrpack metadata:",e),e}},y=async(...t)=>{try{const e=new URL("http://127.0.0.1:8001/utils/path_join/");t.forEach(o=>e.searchParams.append("paths",o));const r=await fetch(e.toString(),{method:"GET"});if(!r.ok){const o=await r.text().catch(()=>r.statusText);throw new Error(`Request failed (${r.status}): ${o}`)}return await r.text()}catch(e){throw console.error("Error joining paths:",e),e}},w=async()=>{try{const t=new URL("http://127.0.0.1:8001/minecraft/minecraft_directory/"),e=await fetch(t.toString(),{method:"GET",cache:"no-store"});if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()}catch(t){throw console.error("Error fetching random projects:",t),t}},u=async t=>{try{const e=new URL("http://127.0.0.1:8001/minecraft/add_vanilla_launcher/");e.searchParams.set("mrpack_directory",t.mrpack_path),e.searchParams.set("profile_directory",t.installation_directory),t.memory?.min&&t.memory?.max&&(e.searchParams.set("java_min",t.memory?.min!=""?String(t.memory.min):"2"),e.searchParams.set("java_max",t.memory?.max!=""?String(t.memory.max):"4")),t.profile_icon&&e.searchParams.set("icon",t.profile_icon??"Furnace");const r=await fetch(e.toString(),{method:"POST",cache:"no-store"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(e){throw console.error("Error fetching random projects:",e),e}},k=async(t,e,r,n,o,s)=>{try{const l=await fetch("http://127.0.0.1:8001/mrpack/install/start/",{method:"POST",cache:"no-store",headers:{"Content-Type":"application/json"},body:JSON.stringify({installation_type:t.type,mrpack_directory:t.mrpack_path,profile_directory:t.installation_directory})});if(!l.ok)throw new Error(`HTTP ${l.status}`);const{install_id:m}=await l.json(),d=new EventSource(`http://127.0.0.1:8001/install/stream/${m}`);d.onmessage=i=>{const c=JSON.parse(i.data);c.type==="status"&&e?e(c.message):c.type==="max"&&r?r(c.message):c.type==="progress"&&n?n(c.message):c.type==="error"&&s?(d.close(),s(c.message)):c.type==="done"&&(d.close(),o?o(c.message):e&&e("Installation completed!"))},d.onerror=i=>{console.error("SSE error",i),s?s(i.toString()):e&&e(i.toString())}}catch(h){throw console.error("Error fetching random projects:",h),h}};a.contextBridge.exposeInMainWorld("electronAPI",{invoke:(t,...e)=>a.ipcRenderer.invoke(t,...e),send:(t,...e)=>a.ipcRenderer.send(t,...e),on:(t,e)=>a.ipcRenderer.on(t,(r,...n)=>e(...n)),off:(t,e)=>a.ipcRenderer.removeListener(t,e)});a.contextBridge.exposeInMainWorld("winConfig",{getTheme:()=>a.ipcRenderer.invoke("get-theme"),getFullscreen:()=>a.ipcRenderer.invoke("get-fullscreen"),getLanguage:()=>a.ipcRenderer.invoke("get-language"),setTheme:t=>a.ipcRenderer.invoke("set-theme",t),getSystemTheme:()=>a.ipcRenderer.invoke("get-system-theme"),setFullscreen:t=>a.ipcRenderer.invoke("set-fullscreen",t),updateApp:()=>a.ipcRenderer.invoke("update-app"),checkUpdate:()=>a.ipcRenderer.invoke("check-update"),getVersion:()=>a.ipcRenderer.invoke("get-version")});a.contextBridge.exposeInMainWorld("backend",{fetchRandomProjects:t=>p(t),searchProjects:(t,e,r,n)=>f(t,e,r,n),GetMrpackMedatadaInfo:t=>g(t),PathJoin:(...t)=>y(...t),GetMinecraftDirectory:()=>w(),AddVanillaLauncher:t=>u(t),StartMrpackInstallation:(t,e,r,n,o,s)=>k(t,e,r,n,o,s)});console.log("Preload script loaded successfully.");
