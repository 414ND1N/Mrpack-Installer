"use strict";const n=require("electron"),f=async(t,e,r,o,a,s)=>{try{const l=await fetch("http://127.0.0.1:8001/mrpack/install/start/",{method:"POST",cache:"no-store",headers:{"Content-Type":"application/json"},body:JSON.stringify({installation_type:t.type,mrpack_directory:t.mrpack_path,profile_directory:t.installation_directory})});if(!l.ok)throw new Error(`HTTP ${l.status}`);const{install_id:m}=await l.json(),h=new EventSource(`http://127.0.0.1:8001/install/stream/${m}`);h.onmessage=d=>{const c=JSON.parse(d.data);c.type==="status"&&e?e(c.message):c.type==="max"&&r?r(c.message):c.type==="progress"&&o?o(c.message):c.type==="error"&&s?(h.close(),s(c.message)):c.type==="done"&&(h.close(),a?a(c.message):e&&e("Installation completed!"))},h.onerror=d=>{console.error("SSE error",d),s?s(d.toString()):e&&e(d.toString())}}catch(i){throw console.error("Error fetching random projects:",i),i}},p=async(t=10)=>{try{const e=new URL("http://127.0.0.1:8001/modrinth/projects_random/");e.searchParams.set("count",t.toString());const r=await fetch(e.toString(),{method:"GET",cache:"no-store"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(e){throw console.error("Error fetching random projects:",e),e}},w=async(t=10,e,r,o)=>{try{const a=new URL("http://127.0.0.1:8001/modrinth/search/");a.searchParams.set("limit",t.toString()),r&&a.searchParams.set("query",r),o!=null&&a.searchParams.set("offset",o.toString()),e&&a.searchParams.set("facets",JSON.stringify([[`project_type:${e}`]]));const s=await fetch(a.toString(),{method:"GET",cache:"no-store"});if(!s.ok)throw new Error(`HTTP ${s.status}`);return await s.json()}catch(a){throw console.error("Error fetching search projects:",a),a}},g=async t=>{try{const e=await fetch(`http://127.0.0.1:8001/mrpack/metadata/?file_path=${encodeURIComponent(t)}`,{method:"GET",cache:"no-store"});if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()}catch(e){throw console.error("Error fetching Mrpack metadata:",e),e}},u=async(t,e,r,o,a,s=!1)=>{try{const i={collection_id:t.trim(),version:e,loader:r,directory:o,update:a,log:s},l=await fetch("http://127.0.0.1:8001/modrinth/collection/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok){const h=await l.text().catch(()=>l.statusText);throw new Error(`Request failed (${l.status}): ${h}`)}return await l.json()}catch(i){throw console.error("downloadCollection error",i),i}},y=async t=>{try{const e=new URL("http://127.0.0.1:8001/modrinth/collection/info/");e.searchParams.set("collection_id",t);const r=await fetch(e,{method:"GET",cache:"no-store"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(e){throw console.error("Error fetching collection info:",e),e}},k=async(t,e,r)=>{try{const o=new URL("http://127.0.0.1:8001/modrinth/collection/mods/verify");o.searchParams.set("collection_id",t),o.searchParams.set("version",e),o.searchParams.set("loader",r);const a=await fetch(o,{method:"GET",cache:"no-store"});if(!a.ok)throw new Error(`HTTP ${a.status}`);return await a.json()}catch(o){throw console.error("Error fetching mods in collection info:",o),o}},P=async(...t)=>{try{const e=new URL("http://127.0.0.1:8001/utils/path_join/");t.forEach(a=>e.searchParams.append("paths",a));const r=await fetch(e.toString(),{method:"GET"});if(!r.ok){const a=await r.text().catch(()=>r.statusText);throw new Error(`Request failed (${r.status}): ${a}`)}return await r.text()}catch(e){throw console.error("Error joining paths:",e),e}},T=async()=>{try{const t=new URL("http://127.0.0.1:8001/minecraft/minecraft_directory/"),e=await fetch(t.toString(),{method:"GET",cache:"no-store"});if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()}catch(t){throw console.error("Error fetching random projects:",t),t}},R=async t=>{try{const e=new URL("http://127.0.0.1:8001/minecraft/add_vanilla_launcher/");e.searchParams.set("mrpack_directory",t.mrpack_path),e.searchParams.set("profile_directory",t.installation_directory),t.memory?.min&&t.memory?.max&&(e.searchParams.set("java_min",t.memory?.min!=""?String(t.memory.min):"2"),e.searchParams.set("java_max",t.memory?.max!=""?String(t.memory.max):"4")),t.profile_icon&&e.searchParams.set("icon",t.profile_icon??"Furnace");const r=await fetch(e.toString(),{method:"POST",cache:"no-store"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(e){throw console.error("Error fetching random projects:",e),e}};n.contextBridge.exposeInMainWorld("electronAPI",{invoke:(t,...e)=>n.ipcRenderer.invoke(t,...e),send:(t,...e)=>n.ipcRenderer.send(t,...e),on:(t,e)=>n.ipcRenderer.on(t,(r,...o)=>e(...o)),off:(t,e)=>n.ipcRenderer.removeListener(t,e)});n.contextBridge.exposeInMainWorld("winConfig",{getTheme:()=>n.ipcRenderer.invoke("get-theme"),getFullscreen:()=>n.ipcRenderer.invoke("get-fullscreen"),getLanguage:()=>n.ipcRenderer.invoke("get-language"),setTheme:t=>n.ipcRenderer.invoke("set-theme",t),getSystemTheme:()=>n.ipcRenderer.invoke("get-system-theme"),setFullscreen:t=>n.ipcRenderer.invoke("set-fullscreen",t),setLanguage:t=>n.ipcRenderer.invoke("set-language",t),getSystemLanguage:()=>n.ipcRenderer.invoke("get-system-language"),updateApp:()=>n.ipcRenderer.invoke("update-app"),checkUpdate:()=>n.ipcRenderer.invoke("check-update"),getVersion:()=>n.ipcRenderer.invoke("get-version"),ShowOpenDialog:t=>n.ipcRenderer.invoke("dialog:showOpenDialog",t)});n.contextBridge.exposeInMainWorld("backend",{fetchRandomProjects:t=>p(t),searchProjects:(t,e,r,o)=>w(t,e,r,o),GetMrpackMedatadaInfo:t=>g(t),PathJoin:(...t)=>P(...t),GetMinecraftDirectory:()=>T(),AddVanillaLauncher:t=>R(t),StartMrpackInstallation:(t,e,r,o,a,s)=>f(t,e,r,o,a,s),DownloadCollection:(t,e,r,o,a)=>u(t,e,r,o,a),GetCollectionInfo:t=>y(t),GetModsInCollectionInfo:(t,e,r)=>k(t,e,r)});console.log("Preload script loaded successfully.");
