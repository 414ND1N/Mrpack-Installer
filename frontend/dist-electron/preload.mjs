"use strict";const o=require("electron"),p=async(e=10)=>{try{const t=new URL("http://127.0.0.1:8001/modrinth/projects_random/");t.searchParams.set("count",e.toString());const r=await fetch(t.toString(),{method:"GET",cache:"no-store"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(t){throw console.error("Error fetching random projects:",t),t}},f=async(e=10,t,r,n)=>{try{const a=new URL("http://127.0.0.1:8001/modrinth/search/");a.searchParams.set("limit",e.toString()),r&&a.searchParams.set("query",r),n!=null&&a.searchParams.set("offset",n.toString()),t&&a.searchParams.set("facets",JSON.stringify([[`project_type:${t}`]]));const s=await fetch(a.toString(),{method:"GET",cache:"no-store"});if(!s.ok)throw new Error(`HTTP ${s.status}`);return await s.json()}catch(a){throw console.error("Error fetching search projects:",a),a}},g=async e=>{try{const t=await fetch(`http://127.0.0.1:8001/mrpack/metadata/?file_path=${encodeURIComponent(e)}`,{method:"GET",cache:"no-store"});if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching Mrpack metadata:",t),t}},w=async(...e)=>{try{const t=new URL("http://127.0.0.1:8001/utils/path_join/");e.forEach(a=>t.searchParams.append("paths",a));const r=await fetch(t.toString(),{method:"GET"});if(!r.ok){const a=await r.text().catch(()=>r.statusText);throw new Error(`Request failed (${r.status}): ${a}`)}return await r.text()}catch(t){throw console.error("Error joining paths:",t),t}},y=async()=>{try{const e=new URL("http://127.0.0.1:8001/minecraft/minecraft_directory/"),t=await fetch(e.toString(),{method:"GET",cache:"no-store"});if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()}catch(e){throw console.error("Error fetching random projects:",e),e}},u=async e=>{try{const t=new URL("http://127.0.0.1:8001/minecraft/add_vanilla_launcher/");t.searchParams.set("mrpack_directory",e.mrpack_path),t.searchParams.set("profile_directory",e.installation_directory),e.memory?.min&&e.memory?.max&&(t.searchParams.set("java_min",e.memory?.min!=""?String(e.memory.min):"2"),t.searchParams.set("java_max",e.memory?.max!=""?String(e.memory.max):"4")),e.profile_icon&&t.searchParams.set("icon",e.profile_icon??"Furnace");const r=await fetch(t.toString(),{method:"POST",cache:"no-store"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(t){throw console.error("Error fetching random projects:",t),t}},k=async(e,t,r,n,a,s)=>{try{const l=await fetch("http://127.0.0.1:8001/mrpack/install/start/",{method:"POST",cache:"no-store",headers:{"Content-Type":"application/json"},body:JSON.stringify({installation_type:e.type,mrpack_directory:e.mrpack_path,profile_directory:e.installation_directory})});if(!l.ok)throw new Error(`HTTP ${l.status}`);const{install_id:m}=await l.json(),d=new EventSource(`http://127.0.0.1:8001/install/stream/${m}`);d.onmessage=i=>{const c=JSON.parse(i.data);c.type==="status"&&t?t(c.message):c.type==="max"&&r?r(c.message):c.type==="progress"&&n?n(c.message):c.type==="error"&&s?(d.close(),s(c.message)):c.type==="done"&&(d.close(),a?a(c.message):t&&t("Installation completed!"))},d.onerror=i=>{console.error("SSE error",i),s?s(i.toString()):t&&t(i.toString())}}catch(h){throw console.error("Error fetching random projects:",h),h}};o.contextBridge.exposeInMainWorld("electronAPI",{invoke:(e,...t)=>o.ipcRenderer.invoke(e,...t),send:(e,...t)=>o.ipcRenderer.send(e,...t),on:(e,t)=>o.ipcRenderer.on(e,(r,...n)=>t(...n)),off:(e,t)=>o.ipcRenderer.removeListener(e,t)});o.contextBridge.exposeInMainWorld("winConfig",{getTheme:()=>o.ipcRenderer.invoke("get-theme"),getFullscreen:()=>o.ipcRenderer.invoke("get-fullscreen"),getLanguage:()=>o.ipcRenderer.invoke("get-language"),setTheme:e=>o.ipcRenderer.invoke("set-theme",e),getSystemTheme:()=>o.ipcRenderer.invoke("get-system-theme"),setFullscreen:e=>o.ipcRenderer.invoke("set-fullscreen",e),setLanguage:e=>o.ipcRenderer.invoke("set-language",e),updateApp:()=>o.ipcRenderer.invoke("update-app"),checkUpdate:()=>o.ipcRenderer.invoke("check-update"),getVersion:()=>o.ipcRenderer.invoke("get-version"),ShowOpenDialog:e=>o.ipcRenderer.invoke("dialog:showOpenDialog",e)});o.contextBridge.exposeInMainWorld("backend",{fetchRandomProjects:e=>p(e),searchProjects:(e,t,r,n)=>f(e,t,r,n),GetMrpackMedatadaInfo:e=>g(e),PathJoin:(...e)=>w(...e),GetMinecraftDirectory:()=>y(),AddVanillaLauncher:e=>u(e),StartMrpackInstallation:(e,t,r,n,a,s)=>k(e,t,r,n,a,s)});console.log("Preload script loaded successfully.");
