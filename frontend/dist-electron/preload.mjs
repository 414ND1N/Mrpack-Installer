"use strict";const a=require("electron"),p=async(e,t,r,n,o,s)=>{try{const l=await fetch("http://127.0.0.1:8001/mrpack/install/start/",{method:"POST",cache:"no-store",headers:{"Content-Type":"application/json"},body:JSON.stringify({installation_type:e.type,mrpack_directory:e.mrpack_path,profile_directory:e.installation_directory})});if(!l.ok)throw new Error(`HTTP ${l.status}`);const{install_id:m}=await l.json(),h=new EventSource(`http://127.0.0.1:8001/install/stream/${m}`);h.onmessage=d=>{const c=JSON.parse(d.data);c.type==="status"&&t?t(c.message):c.type==="max"&&r?r(c.message):c.type==="progress"&&n?n(c.message):c.type==="error"&&s?(h.close(),s(c.message)):c.type==="done"&&(h.close(),o?o(c.message):t&&t("Installation completed!"))},h.onerror=d=>{console.error("SSE error",d),s?s(d.toString()):t&&t(d.toString())}}catch(i){throw console.error("Error fetching random projects:",i),i}},f=async(e=10)=>{try{const t=new URL("http://127.0.0.1:8001/modrinth/projects_random/");t.searchParams.set("count",e.toString());const r=await fetch(t.toString(),{method:"GET",cache:"no-store"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(t){throw console.error("Error fetching random projects:",t),t}},g=async(e=10,t,r,n)=>{try{const o=new URL("http://127.0.0.1:8001/modrinth/search/");o.searchParams.set("limit",e.toString()),r&&o.searchParams.set("query",r),n!=null&&o.searchParams.set("offset",n.toString()),t&&o.searchParams.set("facets",JSON.stringify([[`project_type:${t}`]]));const s=await fetch(o.toString(),{method:"GET",cache:"no-store"});if(!s.ok)throw new Error(`HTTP ${s.status}`);return await s.json()}catch(o){throw console.error("Error fetching search projects:",o),o}},w=async e=>{try{const t=await fetch(`http://127.0.0.1:8001/mrpack/metadata/?file_path=${encodeURIComponent(e)}`,{method:"GET",cache:"no-store"});if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching Mrpack metadata:",t),t}},u=async(e,t,r,n,o,s=!0)=>{try{const i={collection_id:e.trim(),version:t,loader:r,directory:n,update:o,log:s},l=await fetch("http://127.0.0.1:8001/modrinth/collection/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok){const h=await l.text().catch(()=>l.statusText);throw new Error(`Request failed (${l.status}): ${h}`)}return await l.json()}catch(i){throw console.error("downloadCollection error",i),i}},y=async(...e)=>{try{const t=new URL("http://127.0.0.1:8001/utils/path_join/");e.forEach(o=>t.searchParams.append("paths",o));const r=await fetch(t.toString(),{method:"GET"});if(!r.ok){const o=await r.text().catch(()=>r.statusText);throw new Error(`Request failed (${r.status}): ${o}`)}return await r.text()}catch(t){throw console.error("Error joining paths:",t),t}},k=async()=>{try{const e=new URL("http://127.0.0.1:8001/minecraft/minecraft_directory/"),t=await fetch(e.toString(),{method:"GET",cache:"no-store"});if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()}catch(e){throw console.error("Error fetching random projects:",e),e}},P=async e=>{try{const t=new URL("http://127.0.0.1:8001/minecraft/add_vanilla_launcher/");t.searchParams.set("mrpack_directory",e.mrpack_path),t.searchParams.set("profile_directory",e.installation_directory),e.memory?.min&&e.memory?.max&&(t.searchParams.set("java_min",e.memory?.min!=""?String(e.memory.min):"2"),t.searchParams.set("java_max",e.memory?.max!=""?String(e.memory.max):"4")),e.profile_icon&&t.searchParams.set("icon",e.profile_icon??"Furnace");const r=await fetch(t.toString(),{method:"POST",cache:"no-store"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(t){throw console.error("Error fetching random projects:",t),t}};a.contextBridge.exposeInMainWorld("electronAPI",{invoke:(e,...t)=>a.ipcRenderer.invoke(e,...t),send:(e,...t)=>a.ipcRenderer.send(e,...t),on:(e,t)=>a.ipcRenderer.on(e,(r,...n)=>t(...n)),off:(e,t)=>a.ipcRenderer.removeListener(e,t)});a.contextBridge.exposeInMainWorld("winConfig",{getTheme:()=>a.ipcRenderer.invoke("get-theme"),getFullscreen:()=>a.ipcRenderer.invoke("get-fullscreen"),getLanguage:()=>a.ipcRenderer.invoke("get-language"),setTheme:e=>a.ipcRenderer.invoke("set-theme",e),getSystemTheme:()=>a.ipcRenderer.invoke("get-system-theme"),setFullscreen:e=>a.ipcRenderer.invoke("set-fullscreen",e),setLanguage:e=>a.ipcRenderer.invoke("set-language",e),getSystemLanguage:()=>a.ipcRenderer.invoke("get-system-language"),updateApp:()=>a.ipcRenderer.invoke("update-app"),checkUpdate:()=>a.ipcRenderer.invoke("check-update"),getVersion:()=>a.ipcRenderer.invoke("get-version"),ShowOpenDialog:e=>a.ipcRenderer.invoke("dialog:showOpenDialog",e)});a.contextBridge.exposeInMainWorld("backend",{fetchRandomProjects:e=>f(e),searchProjects:(e,t,r,n)=>g(e,t,r,n),GetMrpackMedatadaInfo:e=>w(e),PathJoin:(...e)=>y(...e),GetMinecraftDirectory:()=>k(),AddVanillaLauncher:e=>P(e),StartMrpackInstallation:(e,t,r,n,o,s)=>p(e,t,r,n,o,s),DownloadCollection:(e,t,r,n,o)=>u(e,t,r,n,o)});console.log("Preload script loaded successfully.");
